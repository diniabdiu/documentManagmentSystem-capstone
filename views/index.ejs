<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Twitter -->
  <!-- <meta name="twitter:site" content="@themepixels">
    <meta name="twitter:creator" content="@themepixels">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="DashForge">
    <meta name="twitter:description" content="Responsive Bootstrap 4 Dashboard Template">
    <meta name="twitter:image" content="http://themepixels.me/dashforge/img/dashforge-social.png"> -->

  <!-- Facebook -->
  <!-- <meta property="og:url" content="http://themepixels.me/dashforge">
    <meta property="og:title" content="DashForge">
    <meta property="og:description" content="Responsive Bootstrap 4 Dashboard Template">

    <meta property="og:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">
    <meta property="og:image:secure_url" content="http://themepixels.me/dashforge/img/dashforge-social.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="600"> -->
  <!-- Meta -->
  <meta name="description" content="Responsive Bootstrap 4 Dashboard Template">
  <meta name="author" content="ThemePixels">

  <title>Document Managment System</title>

  <!-- vendor css -->
  <link href="../../lib/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="../../lib/ionicons/css/ionicons.min.css" rel="stylesheet">

  <!-- DashForge CSS -->
  <link rel="stylesheet" href="../../assets/css/dashforge.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="../../assets/css/dashforge.filemgr.css">

  <!-- Load first scripts -->
  <script src="../../lib/jquery/jquery.min.js" sync></script>
  <script src="../../lib/bootstrap/js/bootstrap.bundle.min.js" sync></script>
</head>

<body class="app-filemgr">



  <div class="content ht-100v pd-0">

    <div class="content-body pd-0">
      <div class="filemgr-wrapper filemgr-wrapper-two">
        <div class="filemgr-sidebar">
          <div class="filemgr-sidebar-header">
            <div class="dropdown dropdown-icon flex-fill">
              <button class="btn btn-xs btn-block btn-white" data-toggle="dropdown">New <i
                  data-feather="chevron-down"></i></button>
              <div class="dropdown-menu tx-13">
                <%# <a href="" class="dropdown-item"><i data-feather="folder"></i><span>Folder</span></a> %>
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary" style="width: 100%" data-toggle="modal"
                  data-target="#create-folder-form-modal">
                  Create folder
                </button>


                <!-- <a href="" class="dropdown-item"><i data-feather="file"></i><span>Notes</span></a>
                <div class="dropdown-divider"></div>
                <a href="" class="dropdown-item"><i data-feather="file-text"></i><span>Word Document</span></a>
                <a href="" class="dropdown-item"><i data-feather="file-text"></i><span>Powepoint</span></a>
                <a href="" class="dropdown-item"><i data-feather="file-text"></i><span>Excel Spreadsheet</span></a> -->
              </div><!-- dropdown-menu -->
            </div><!-- dropdown -->
            <div class="dropdown dropdown-icon flex-fill mg-l-10">
              <button class="btn btn-xs btn-block btn-primary" data-toggle="dropdown">Upload <i
                  data-feather="chevron-down"></i></button>
              <div class="dropdown-menu tx-13">
              <form id="uploadForm">
                  <input id="file" type="file">
                  <button id="submit-file">Submit</button>
              </form>
              </div><!-- dropdown-menu -->
            </div><!-- dropdown -->
          </div>
          <!-- filemgr-sidebar-header -->
          <%- include partials/left-sidebar.ejs %>
          <!-- filemgr-sidebar-body -->
        </div><!-- filemgr-sidebar -->

        <div class="filemgr-content">
          <div class="filemgr-content-header">
            <h4 class="mg-b-0">All Files</h4>
            <nav class="nav d-none d-sm-flex mg-l-auto">
              <a href="/logout" class="nav-link">Logout&nbsp;<i data-feather="log-out"></i></a>
            </nav>
          </div><!-- filemgr-content-header -->
          <div class="filemgr-content-body">
            <div class="pd-20 pd-lg-25 pd-xl-30">
                <label class="d-block tx-medium tx-10 tx-uppercase tx-sans tx-spacing-1 tx-color-03 mg-b-15">Folders</label>
                <div id="folder-container" class="row row-xs">
                </div><!-- row -->
              <hr class="mg-y-40 bd-0">
              
              <label class="d-block tx-medium tx-10 tx-uppercase tx-sans tx-spacing-1 tx-color-03 mg-b-15">Recently
                Accessed Files</label>
              <div id="files-container" class="row row-xs">
                <p>Select a Folder</p>
              </div>



            </div>
          </div>
        </div><!-- filemgr-content -->

      </div><!-- filemgr-wrapper -->
    </div>
  </div><!-- content -->


  <div class="modal fade effect-scale" id="modalCopy" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-body pd-20 pd-sm-30">
          <button type="button" class="close pos-absolute t-15 r-20" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>

          <h5 class="tx-18 tx-sm-20 mg-b-0">Copy Item to</h5>
          <p class="mg-b-25 tx-color-03">Please select a folder</p>

          <div class="bd bg-ui-01 pd-10">
            <ul class="nav nav-sidebar flex-column tx-13">
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Downloads</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Personal Stuff</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> 3d Objects</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Recordings</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Support</a></li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary mg-sm-r-5" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Copy</button>
        </div><!-- modal-footer -->
      </div><!-- modal-content -->
    </div><!-- modal-dialog -->
  </div><!-- modal -->

  <div class="modal fade effect-scale" id="modalMove" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-body pd-20 pd-sm-30">
          <button type="button" class="close pos-absolute t-15 r-20" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>

          <h5 class="tx-18 tx-sm-20 mg-b-0">Move Item to</h5>
          <p class="mg-b-25 tx-color-03">Please select a folder</p>

          <div class="bd bg-ui-01 pd-10">
            <ul class="nav nav-sidebar flex-column tx-13">
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Downloads</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Personal Stuff</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> 3d Objects</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Recordings</a></li>
              <li class="nav-item"><a href="" class="nav-link"><i data-feather="folder"></i> Support</a></li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary mg-sm-r-5" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Move</button>
        </div><!-- modal-footer -->
      </div><!-- modal-content -->
    </div><!-- modal-dialog -->
  </div><!-- modal -->


  <script type="text/javascript">
    jQuery(document).ready(() => {
        $ = jQuery;


        // init
        $.getJSON("/api/folder", function (folders) {
            $('#folders-container').html("");
            data.forEach(folder => {
              $('#folders-container').append(`
                <div class="col-sm-6 col-lg-4 col-xl-3">
                    <div class="media media-folder">
                      <i data-feather="folder"></i>
                      <div class="media-body">
                        <h6><a href="" class="link-02">${folder.name}</a></h6>
                      </div><!-- media-body -->
                      <div class="dropdown-file">
                        <a href="" class="dropdown-link" data-toggle="dropdown"><i data-feather="more-vertical"></i></a>
                        <div class="dropdown-menu dropdown-menu-right">
                          
                          <a href="#modalMove" data-toggle="modal" class="dropdown-item move"><i
                              data-feather="folder"></i>Move to</a>
                          <a href="#" class="dropdown-item rename"><i data-feather="edit"></i>Rename</a>
                          <a href="#" class="dropdown-item delete" id="${folder._id}"><i data-feather="trash"></i>Delete</a>
                        </div>
                      </div><!-- dropdown -->
                    </div><!-- media -->
                </div><!-- col -->
              `);
            });
        })
        .fail(function () {
            console.log("error");
        });


        // get its files
        function getFiles(id) {
            $.ajax({
              url: `/api/folder/${id}`,
              type: 'GET',
              success: data => {
                renderFiles(data);
              }
          });
        }
      
        let renderFiles = (data) => {
          if (data.documents instanceof Array) {
            $('#files-container').html("");

            if (data.documents.length === 0 ) {
              $('#files-container').html("<p>No files.</p>");
              return;
            };
            data.documents.map(doc => {
            $('#files-container').append(`
              <div class="col-6 col-sm-4 col-md-3 col-xl">
                  <div class="card card-file">
                    <div class="dropdown-file">
                      <a href="" class="dropdown-link" data-toggle="dropdown"><i data-feather="more-vertical"></i></a>
                      <div class="dropdown-menu dropdown-menu-right">
                        <a href="" class="dropdown-item important"><i data-feather="star"></i>Mark as Important</a>
                        <a href="#modalMove" data-toggle="modal" class="dropdown-item move"><i
                            data-feather="folder"></i>Move to</a>
                        <a href="#" class="dropdown-item rename"><i data-feather="edit"></i>Rename</a>
                        <a href="#" class="dropdown-item delete"><i data-feather="trash"></i>Delete</a>
                      </div>
                    </div><!-- dropdown -->
                    <div class="card-file-thumb tx-danger">
                      <i class="far fa-file-pdf"></i>
                    </div>
                    <div class="card-body">
                      <h6><a href="" class="link-02">${doc.originalname}</a></h6>
                      <span>10.45kb (mock)</span>
                    </div>
                  </div>
                </div><!-- col -->
            `);
            });
            return;
          } else {
            $('#files-container').html("");
            $('#files-container').append(`
              <div class="col-6 col-sm-4 col-md-3 col-xl">
                  <div class="card card-file">
                    <div class="dropdown-file">
                      <a href="" class="dropdown-link" data-toggle="dropdown"><i data-feather="more-vertical"></i></a>
                      <div class="dropdown-menu dropdown-menu-right">
                        <a href="" class="dropdown-item important"><i data-feather="star"></i>Mark as Important</a>
                        <a href="#modalMove" data-toggle="modal" class="dropdown-item move"><i
                            data-feather="folder"></i>Move to</a>
                        <a href="#" class="dropdown-item rename"><i data-feather="edit"></i>Rename</a>
                        <a href="#" class="dropdown-item delete"><i data-feather="trash"></i>Delete</a>
                      </div>
                    </div><!-- dropdown -->
                    <div class="card-file-thumb tx-danger">
                      <i class="far fa-file-pdf"></i>
                    </div>
                    <div class="card-body">
                      <h6><a href="" class="link-02">${data.document.originalname}</a></h6>
                      <span>10.45kb (mock)</span>
                    </div>
                  </div>
              </div><!-- col -->
          `);
          }
        };

        var id = '';
        // click on a folder
        $('body').on('click', '.pickFolder', function(e) {
          let arrFolderElem = $(this).parent().parent().parent();
          $(arrFolderElem).find('.pickFolder > a').removeClass('active');

          $(this).find('a').addClass('active');
          id = $(this).attr('id');
          getFiles(id);
          console.log(typeof id, id);
        });

        // submit the file
        $('#submit-file').click(e => {
            e.preventDefault();
            if (id.length != 0) {
              var formData = new FormData();
              formData.append('file', $('#file')[0].files[0]);
              formData.append('locationId', id);

              $.ajax({
                  url : '/upload',
                  type : 'POST',
                  data : formData,
                  contentType: 'application/json',
                  processData: false, 
                  contentType: false, 
                  success : function(data) {
                    renderFiles(data);
                  }
              });
              return false;
            }
            alert('duhesh me zgjedh nje folder');
          });
        
    });
</script>
  
  <!-- Create folder component modal -->
  <%- include partials/create-folder-modal.ejs %>
  <!-- Create folder component modal -->

  <script src="../../lib/feather-icons/feather.min.js"></script>
  <script src="../../lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>

  <script src="../../assets/js/dashforge.js"></script>
  <script src="../../assets/js/dashforge.aside.js"></script>
  <script src="../../assets/js/dashforge.filemgr.js"></script>


  <!-- append theme customizer -->
  <script src="../../lib/js-cookie/js.cookie.js"></script>
  <script src="../../assets/js/dashforge.settings.js"></script>

  <script>
    'use strict'

    $(document).ready(function () {
      if (window.matchMedia('(min-width: 1200px)').matches) {
        $('.aside').addClass('minimize');
      }
    })
  </script>

  <!-- Import Components -->
  <%- include partials/component-scripts.ejs %>
</body>

</html>